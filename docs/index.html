<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansible Galaxy Docker Compose</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #880E4F;
            --primary-dark: #560027;
            --primary-light: #BC477B;
            --secondary: #FF80AB;
            --background: #FAFAFA;
            --surface: #FFFFFF;
            --error: #D32F2F;
            --text-primary: #212121;
            --text-secondary: #757575;
            --divider: #BDBDBD;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 60px 0;
            box-shadow: 0 4px 20px rgba(136, 14, 79, 0.3);
        }
        header h1 {
            font-size: 2.5em;
            font-weight: 500;
            margin-bottom: 10px;
        }
        header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-weight: 300;
        }
        .badge {
            display: inline-block;
            background: rgba(255,255,255,0.15);
            padding: 8px 20px;
            border-radius: 20px;
            margin: 5px;
            font-weight: 300;
        }
        .content {
            background: var(--surface);
            border-radius: 8px;
            padding: 40px;
            margin: -30px auto 40px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            padding-bottom: 10px;
            margin-bottom: 25px;
            font-weight: 500;
        }
        .section h3 {
            color: var(--primary-dark);
            margin: 20px 0 15px;
            font-weight: 500;
        }
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .service-card {
            background: linear-gradient(135deg, #f8f8f8 0%, #f0f0f0 100%);
            padding: 25px;
            border-radius: 8px;
            border-left: 5px solid var(--primary);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .service-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(136, 14, 79, 0.2);
        }
        .service-card h3 {
            color: var(--primary-dark);
            margin-bottom: 10px;
            font-weight: 500;
        }
        .service-card p {
            color: var(--text-secondary);
            font-size: 0.95em;
        }
        .code {
            background: #263238;
            color: #ECEFF1;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
            line-height: 1.8;
            margin: 15px 0;
        }
        .code-comment { color: #6A9955; }
        .code-string { color: #CE9178; }
        .code-keyword { color: #569CD6; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: var(--surface);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--divider);
        }
        th {
            background: var(--primary);
            color: white;
            font-weight: 500;
        }
        tr:hover {
            background: #F5F5F5;
        }
        td:first-child {
            font-weight: 500;
            color: var(--primary-dark);
        }
        .config-section {
            background: #F5F5F5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .config-section h3 {
            color: var(--primary);
            margin-bottom: 15px;
        }
        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            background: var(--primary-dark);
            color: white;
        }
        footer a {
            color: var(--secondary);
        }
        .nav-tabs {
            display: flex;
            border-bottom: 2px solid var(--divider);
            margin-bottom: 20px;
        }
        .nav-tab {
            padding: 15px 30px;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            font-weight: 500;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .example-box {
            background: #E8F5E9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .warning-box {
            background: #FFF3E0;
            border-left: 4px solid #FF9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .info-box {
            background: #E3F2FD;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Ansible Galaxy Docker Compose</h1>
            <p>Native Docker Compose configuration for local Galaxy server</p>
            <div style="margin-top: 25px;">
                <span class="badge">PostgreSQL 15</span>
                <span class="badge">Redis 7</span>
                <span class="badge">Galaxy NG</span>
                <span class="badge">Material Design</span>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="content">
            <div class="section">
                <h2>Services</h2>
                <div class="services">
                    <div class="service-card">
                        <h3>Galaxy Web UI</h3>
                        <p>Web interface at <strong>http://localhost:8080</strong></p>
                    </div>
                    <div class="service-card">
                        <h3>Galaxy API</h3>
                        <p>REST API at <strong>http://localhost:8000/api/galaxy/</strong></p>
                    </div>
                    <div class="service-card">
                        <h3>Galaxy Content</h3>
                        <p>Content service at <strong>http://localhost:24816</strong></p>
                    </div>
                    <div class="service-card">
                        <h3>PostgreSQL</h3>
                        <p>Database at <strong>localhost:5432</strong></p>
                    </div>
                    <div class="service-card">
                        <h3>Redis</h3>
                        <p>Cache at <strong>localhost:6379</strong></p>
                    </div>
                    <div class="service-card">
                        <h3>Galaxy Worker</h3>
                        <p>Background task worker (scalable)</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>Quick Start</h2>
                <div class="code">
<pre><span class="code-comment"># Clone and setup</span>
<span class="code-keyword">git</span> clone https://github.com/AndrewDi/ansible-galaxy-compose.git
<span class="code-keyword">cd</span> ansible-galaxy-compose

<span class="code-comment"># Copy environment file</span>
<span class="code-keyword">cp</span> .env.example .env

<span class="code-comment"># Create certificates directory</span>
<span class="code-keyword">mkdir</span> -p certs
python3 -c <span class="code-string">"import os; print(os.urandom(32).hex())"</span> > certs/database_fields.symmetric.key
<span class="code-keyword">chmod</span> 600 certs/database_fields.symmetric.key

<span class="code-comment"># Start services</span>
docker compose up -d

<span class="code-comment"># Check status</span>
docker compose ps</pre>
                </div>
            </div>

            <div class="section">
                <h2>Default Ports</h2>
                <table>
                    <tr>
                        <th>Service</th>
                        <th>Port</th>
                        <th>URL</th>
                    </tr>
                    <tr>
                        <td>Galaxy Web</td>
                        <td>8080</td>
                        <td>http://localhost:8080</td>
                    </tr>
                    <tr>
                        <td>Galaxy API</td>
                        <td>8000</td>
                        <td>http://localhost:8000/api/galaxy/</td>
                    </tr>
                    <tr>
                        <td>Galaxy Content</td>
                        <td>24816</td>
                        <td>http://localhost:24816/pulp/content/</td>
                    </tr>
                    <tr>
                        <td>PostgreSQL</td>
                        <td>5432</td>
                        <td>localhost:5432</td>
                    </tr>
                    <tr>
                        <td>Redis</td>
                        <td>6379</td>
                        <td>localhost:6379</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>Default Credentials</h2>
                <div class="info-box">
                    <p><strong>Username:</strong> admin</p>
                    <p><strong>Password:</strong> admin</p>
                </div>
            </div>

            <div class="section">
                <h2>Configuration Files</h2>
                <div class="nav-tabs">
                    <div class="nav-tab active" onclick="switchTab('env')">.env Variables</div>
                    <div class="nav-tab" onclick="switchTab('settings')">settings.py</div>
                </div>
                
                <div id="env" class="tab-content active">
                    <div class="config-section">
                        <h3>Database Settings</h3>
                        <table>
                            <tr><td>POSTGRESQL_USER</td><td>galaxy</td><td>Database username</td></tr>
                            <tr><td>POSTGRESQL_PASSWORD</td><td>galaxy</td><td>Database password</td></tr>
                            <tr><td>POSTGRESQL_DATABASE</td><td>galaxy</td><td>Database name</td></tr>
                            <tr><td>POSTGRESQL_HOST</td><td>postgres</td><td>Database host</td></tr>
                            <tr><td>POSTGRESQL_PORT</td><td>5432</td><td>Database port</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Redis Settings</h3>
                        <table>
                            <tr><td>REDIS_HOST</td><td>redis</td><td>Redis host</td></tr>
                            <tr><td>REDIS_PORT</td><td>6379</td><td>Redis port</td></tr>
                            <tr><td>REDIS_PASSWORD</td><td>galaxy</td><td>Redis password</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Galaxy Admin Settings</h3>
                        <table>
                            <tr><td>GALAXY_ADMIN_USER</td><td>admin</td><td>Admin username</td></tr>
                            <tr><td>GALAXY_ADMIN_PASSWORD</td><td>admin</td><td>Admin password</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>API Settings</h3>
                        <table>
                            <tr><td>GALAXY_API_HOSTNAME</td><td>http://galaxy-web.orb.local</td><td>Galaxy API hostname</td></tr>
                            <tr><td>GALAXY_CONTENT_HOSTNAME</td><td>http://galaxy-web.orb.local</td><td>Content hostname</td></tr>
                            <tr><td>CONTENT_ORIGIN</td><td>http://galaxy-web.orb.local</td><td>Content origin URL</td></tr>
                            <tr><td>GALAXY_API_PATH_PREFIX</td><td>api/galaxy</td><td>API path prefix</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Feature Flags</h3>
                        <table>
                            <tr><td>GALAXY_REQUIRE_CONTENT_APPROVAL</td><td>True</td><td>Require approval before publishing</td></tr>
                            <tr><td>GALAXY_ENABLE_ANONYMOUS_ACCESS</td><td>True</td><td>Allow anonymous access</td></tr>
                            <tr><td>GALAXY_ENABLE_UNAUTHENTICATED_COLLECTION_DOWNLOAD</td><td>True</td><td>Allow anonymous downloads</td></tr>
                            <tr><td>GALAXY_ENABLE_UNAUTHENTICATED_COLLECTION_ACCESS</td><td>True</td><td>Allow anonymous collection access</td></tr>
                            <tr><td>EE_ENABLED</td><td>False</td><td>Enable Execution Environments</td></tr>
                            <tr><td>GALAXY_ENABLE_LEGACY_ROLES</td><td>True</td><td>Enable legacy roles support</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Worker Scaling</h3>
                        <table>
                            <tr><td>WORKER_REPLICAS</td><td>1</td><td>Number of worker replicas</td></tr>
                        </table>
                    </div>
                </div>
                
                <div id="settings" class="tab-content">
                    <div class="config-section">
                        <h3>Database (DATABASES)</h3>
                        <table>
                            <tr><td>ENGINE</td><td>django.db.backends.postgresql</td><td>Database engine</td></tr>
                            <tr><td>NAME</td><td>galaxy</td><td>Database name</td></tr>
                            <tr><td>USER</td><td>galaxy</td><td>Database user</td></tr>
                            <tr><td>PASSWORD</td><td>galaxy</td><td>Database password</td></tr>
                            <tr><td>HOST</td><td>postgres</td><td>Database host</td></tr>
                            <tr><td>PORT</td><td>5432</td><td>Database port</td></tr>
                            <tr><td>CONN_MAX_AGE</td><td>0</td><td>Connection lifetime (seconds)</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Redis Cache</h3>
                        <table>
                            <tr><td>REDIS_PASSWORD</td><td>galaxy</td><td>Redis password</td></tr>
                            <tr><td>REDIS_HOST</td><td>redis</td><td>Redis host</td></tr>
                            <tr><td>REDIS_PORT</td><td>6379</td><td>Redis port</td></tr>
                            <tr><td>CACHE_URL</td><td>redis://:galaxy@redis:6379/0</td><td>Redis connection URL</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Security</h3>
                        <table>
                            <tr><td>SECRET_KEY</td><td>(from PULP_SECRET_KEY)</td><td>Django secret key</td></tr>
                            <tr><td>ALLOWED_HOSTS</td><td>*</td><td>Allowed host patterns</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Storage</h3>
                        <table>
                            <tr><td>FILE_UPLOAD_MAX_MEMORY_SIZE</td><td>104857600 (100MB)</td><td>Max file size in memory</td></tr>
                            <tr><td>DATA_UPLOAD_MAX_MEMORY_SIZE</td><td>524288000 (500MB)</td><td>Max data upload size</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Galaxy Settings</h3>
                        <table>
                            <tr><td>GALAXY_API_DEFAULT_DISTRIBUTION_BASE_PATH</td><td>published</td><td>Default distribution path</td></tr>
                            <tr><td>GALAXY_API_STAGING_DISTRIBUTION_BASE_PATH</td><td>staging</td><td>Staging distribution path</td></tr>
                            <tr><td>ANSIBLE_API_HOSTNAME</td><td>(from GALAXY_API_HOSTNAME)</td><td>API hostname</td></tr>
                            <tr><td>X_PULP_CONTENT_HOST</td><td>galaxy-content</td><td>Content host</td></tr>
                            <tr><td>X_PULP_CONTENT_PORT</td><td>24816</td><td>Content port</td></tr>
                        </table>
                    </div>
                    
                    <div class="config-section">
                        <h3>Feature Flags</h3>
                        <table>
                            <tr><td>GALAXY_ENABLE_ANONYMOUS_ACCESS</td><td>True</td><td>Enable anonymous access</td></tr>
                            <tr><td>GALAXY_ENABLE_UNAUTHENTICATED_COLLECTION_DOWNLOAD</td><td>True</td><td>Allow unauthenticated downloads</td></tr>
                            <tr><td>GALAXY_ENABLE_UNAUTHENTICATED_COLLECTION_ACCESS</td><td>True</td><td>Allow unauthenticated collection access</td></tr>
                            <tr><td>GALAXY_REQUIRE_CONTENT_APPROVAL</td><td>False</td><td>Require content approval</td></tr>
                            <tr><td>GALAXY_ENABLE_LEGACY_ROLES</td><td>True</td><td>Enable legacy roles</td></tr>
                            <tr><td>GALAXY_DYNAMIC_SETTINGS</td><td>True</td><td>Enable dynamic settings</td></tr>
                            <tr><td>EE_ENABLED</td><td>False</td><td>Enable Execution Environments</td></tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>ansible-galaxy Command Reference</h2>
                
                <h3>Collection Commands</h3>
                <div class="code">
<pre><span class="code-comment"># Install a collection from Galaxy</span>
ansible-galaxy collection install namespace.collection

<span class="code-comment"># Install specific version</span>
ansible-galaxy collection install namespace.collection:1.0.0

<span class="code-comment"># Install from local file</span>
ansible-galaxy collection install namespace-collection-1.0.0.tar.gz

<span class="code-comment"># Install from custom server</span>
ansible-galaxy collection install namespace.collection --server=http://localhost:8000

<span class="code-comment"># List installed collections</span>
ansible-galaxy collection list

<span class="code-comment"># Build a collection from source</span>
ansible-galaxy collection build

<span class="code-comment"># Publish to Galaxy server</span>
ansible-galaxy collection publish namespace-collection-1.0.0.tar.gz

<span class="code-comment"># Publish to custom server</span>
ansible-galaxy collection publish namespace-collection-1.0.0.tar.gz \
  --server=http://localhost:8000 \
  --api-key=YOUR_API_KEY</pre>
                </div>
                
                <h3>Role Commands</h3>
                <div class="code">
<pre><span class="code-comment"># Install a role from Galaxy</span>
ansible-galaxy role install namespace.role_name

<span class="code-comment"># Install specific version</span>
ansible-galaxy role install namespace.role_name,1.2.0

<span class="code-comment"># List installed roles</span>
ansible-galaxy role list

<span class="code-comment"># Remove a role</span>
ansible-galaxy role remove namespace.role_name</pre>
                </div>
                
                <h3>Galaxy Server Commands</h3>
                <div class="code">
<pre><span class="code-comment"># Login to Galaxy</span>
ansible-galaxy login

<span class="code-comment"># Display Galaxy server status</span>
ansible-galaxy server status

<span class="code-comment"># List available servers</span>
ansible-galaxy server list</pre>
                </div>
                
                <h3>Configuration</h3>
                <div class="code">
<pre><span class="code-comment"># Display current configuration</span>
ansible-galaxy config view

<span class="code-comment"># Get specific config value</span>
ansible-galaxy config server_list

<span class="code-comment"># Set config value (requires Ansible 2.16+)</span>
ansible-galaxy config server_list.test.server_url http://localhost:8000</pre>
                </div>
                
                <div class="example-box">
                    <strong>Example: Full Workflow</strong>
                    <pre style="margin-top: 10px;">
# 1. Build collection
ansible-galaxy collection build

# 2. Publish to local Galaxy server
ansible-galaxy collection publish galaxy_service-1.0.0.tar.gz \
  --server=http://localhost:8000 \
  --api-key=YOUR_API_KEY

# 3. Install collection
ansible-galaxy collection install galaxy_service.galaxy_service \
  --server=http://localhost:8000

# 4. Use in playbook
ansible-playbook my_playbook.yml</pre>
                </div>
            </div>

            <div class="section">
                <h2>Storage Volumes</h2>
                <table>
                    <tr>
                        <th>Volume</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>postgres_data</td>
                        <td>PostgreSQL database</td>
                    </tr>
                    <tr>
                        <td>galaxy_api_data</td>
                        <td>Galaxy artifacts, uploads, and shared data</td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>GitHub Actions</h2>
                <p>This project includes automated workflows:</p>
                <ul style="margin: 15px 0; padding-left: 20px;">
                    <li><strong>CI</strong> - Continuous integration testing</li>
                    <li><strong>Release</strong> - Build and publish Galaxy collection</li>
                    <li><strong>Scale Test</strong> - Test worker scaling capabilities</li>
                    <li><strong>Pages</strong> - Deploy documentation</li>
                </ul>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>Based on <a href="https://github.com/ansible/galaxy-operator" target="_blank">galaxy-operator</a></p>
            <p>&copy; 2024 Ansible Galaxy Compose</p>
        </div>
    </footer>

    <script>
        function switchTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
    </script>
</body>
</html>
